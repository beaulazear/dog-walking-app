module FactoryHelpers
  def create_user(attributes = {})
    User.create!({
      username: "testuser#{rand(1000)}",
      name: "Test User",
      email_address: "test#{rand(1000)}@example.com",
      password: "password123",
      password_confirmation: "password123",
      thirty: 30,
      fourty: 40,
      sixty: 60,
      solo_rate: 35
    }.merge(attributes))
  end

  def create_pet(user = nil, attributes = {})
    user ||= create_user
    Pet.create!({
      user: user,
      name: "Buddy",
      birthdate: Date.current - 2.years,
      sex: "male",
      spayed_neutered: true,
      address: "123 Test Street, Test City, TC 12345",
      behavorial_notes: "Friendly and energetic dog",
      supplies_location: "Garage on left side",
      allergies: "None"
    }.merge(attributes))
  end

  def create_appointment(user = nil, pet = nil, attributes = {})
    user ||= create_user
    pet ||= create_pet(user)
    Appointment.create!({
      user: user,
      pet: pet,
      appointment_date: Date.current + 1.day,
      start_time: "09:00",
      end_time: "10:00",
      duration: 60,
      price: 30,
      recurring: false,
      solo: false,
      completed: false,
      canceled: false,
      monday: false,
      tuesday: false,
      wednesday: false,
      thursday: false,
      friday: false,
      saturday: false,
      sunday: false
    }.merge(attributes))
  end

  def create_invoice(appointment = nil, pet = nil, attributes = {})
    appointment ||= create_appointment
    pet ||= appointment.pet
    Invoice.create!({
      appointment: appointment,
      pet: pet,
      date_completed: Date.current,
      compensation: 30,
      paid: false,
      pending: false,
      title: "Walk for #{pet.name}",
      cancelled: false
    }.merge(attributes))
  end

  def create_cancellation(appointment = nil, attributes = {})
    appointment ||= create_appointment
    Cancellation.create!({
      appointment: appointment,
      date: Date.current + 3.days
    }.merge(attributes))
  end

  def create_additional_income(pet = nil, attributes = {})
    pet ||= create_pet
    AdditionalIncome.create!({
      pet: pet,
      description: "Extra service",
      date_added: Date.current,
      compensation: 15
    }.merge(attributes))
  end
end

RSpec.configure do |config|
  config.include FactoryHelpers
end